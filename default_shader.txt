shader_type spatial;

uniform sampler2D height_texture;
uniform sampler2D normal_texture;
uniform sampler2D color_texture;
uniform vec2 heightmap_resolution;
uniform mat4 heightmap_inverse_transform;

void vertex() {
	vec4 tv = heightmap_inverse_transform * WORLD_MATRIX * vec4(VERTEX, 1);
	vec2 uv = vec2(tv.x,tv.z) / heightmap_resolution;
	float h = texture(height_texture, uv).r;
	vec3 n = texture(normal_texture, uv).rgb;
	n = n * 2.0 - vec3(1.0, 1.0, 1.0);
	VERTEX.y = h;
	NORMAL = n;
}
